<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>% of Population born in Australia</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <div id="map1"></div>
  <div id="map2"></div>

  <script>
    const spec1 = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 500,
        "height": 300,
        "params": [
            {
                "name": "Country_of_Birth_selection",
                "value": "Australia",
                "bind": {
                    "input": "select",
                    "options": [
                        "Australia",
                        "England",
                        "India",
                        "China",
                        "Vietnam",
                        "Italy",
                        "Philippines",
                        "New Zealand",
                        "South Africa",
                        "Nepal"
                    ],
                    "labels": [
                        "Australia",
                        "England",
                        "India",
                        "China",
                        "Vietnam",
                        "Italy",
                        "Philippines",
                        "New Zealand",
                        "South Africa",
                        "Nepal"
                    ],
                    "name": "Country of Birth Selection: "
                }
            }
        ]
        ,
        "layer": [
            {
            "data": {
                "url": "vis/data/hw10.csv",
                "format": {
                "type": "csv"
                }
            },
            "transform": [{
                "lookup": "State",
                "from": {
                "data": {
                    "url": "vis/data/STE_2021_AUST_GDA2020.json",
                    "format": {
                    "type": "topojson",
                    "feature": "STE_2021_AUST_GDA2020"
                    }
                },
                "key": "properties.STE_NAME21"
                },
                "as": "geo"
            },
            {
                "calculate": "(datum.Persons / datum.Total) * 100",
                "as": "% Born"
            },
            {
                "filter": "datum['Country of Birth'] == Country_of_Birth_selection"
            }],
            "projection": {
                "type": "mercator"
            },
            "mark": {
                "type": "geoshape",
                "stroke": "white"
            },
            "encoding": {
                "shape": {"field": "geo", "type": "geojson"}, 
                "color": {
                "field": "% Born",
                "type": "quantitative",
                "scale": {
                    "scheme": "reds"
                }
                },
                "tooltip": [
                {"field": "State", "title": "State"},
                {"field": "% Born", "title": "% Born", "format": ".2f"}
                ]
            }
            },
                {
            "data": {
                "values":[
                {"state_name": "VIC", "lat":-37, "long":144},
                {"state_name": "NT", "lat":-20, "long":133.5},
                {"state_name": "SA", "lat":-30, "long":135},
                {"state_name": "WA", "lat":-26, "long":122},
                {"state_name": "QLD", "lat":-24, "long":145},
                {"state_name": "NSW", "lat":-32, "long":146},
                {"state_name": "ACT", "lat":-35.7, "long":152},
                {"state_name": "TAS", "lat":-42, "long":143}
                ]
            },
            "projection": {
                "type": "mercator"
            },
            "mark": {
                "type":"text",
                "fill": "blue",
                "fontSize": 12,
                "fontWeight": "bold"
            },
            "encoding":  {
                "latitude": {
                "field": "lat"
                },
                "longitude": {
                "field": "long"
                },
                "text": {
                "field": "state_name"
                }
            }
            }
        ]
        
    }
    vegaEmbed('#map1', spec1);

  </script>

  <script>
    const spec2 = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 800,
        "height": 500,
        "layer": [
        {
            "data": {
            "url": "vis/data/world_map.json",
            "format": {
                "type": "topojson",
                "feature": "custom.geo"
            }
            },
            "projection": {
            "type": "mercator",
            "center": [0, 50],  
            "scale": 100
            },
            "mark": {
            "type": "geoshape",
            "fill": "lightgray",
            "stroke": "white"
            }
        },
        {
            "data": {
            "url": "vis/data/ne_110m_graticules_30.json",
            "format": {
                "type": "topojson",
                "feature": "ne_110m_graticules_30"
            }
            },
            "projection": {
            "type": "mercator",
            "center": [0, 50],  
            "scale": 100
            },
            "mark": {
            "type": "geoshape",
            "stroke": "lightblue",
            "strokeWidth": 0.5
            }
        },
        {
            "data": {
            "url": "vis/data/CoBAus.csv"
            },
            "transform": [
            {
                "lookup": "Country",
                "from": {
                "data": {
                    "url": "vis/data/countries.csv"
                },
                "key": "name",
                "fields": ["latitude", "longitude"]
                },
                "as": ["origin_latitude", "origin_longitude"]
            },
            {
                "calculate": "-25.2744",
                "as": "dest_latitude"
            },
            {
                "calculate": "133.7751",
                "as": "dest_longitude"
            }
            ],
            "projection": {
            "type": "mercator",
            "center": [0, 50],  
            "scale": 100
            },
            "mark": {
            "type":"rule",
            "color": "red",
            "opacity": 0.7
            },
            "encoding": {
            "longitude": {
                "field": "origin_longitude",
                "type": "quantitative"
            },
            "latitude": {
                "field": "origin_latitude",
                "type": "quantitative"
            },
            "strokeWidth": {
                "field": "Persons",
                "type": "quantitative",
                "scale": {
                    "range": [1, 8]
                }
            },
            "longitude2": {"field": "dest_longitude"},
            "latitude2": {"field": "dest_latitude"}
            }
        }
        ]
    }
        vegaEmbed('#map2', spec2);
  </script>
</body>

</html>